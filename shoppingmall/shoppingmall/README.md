# Shopping Mall Backend

A simple Spring Boot backend for a shopping mall. It accepts JSON from Insomnia/Postman and persists to PostgreSQL. Tables are auto-generated by Hibernate.

## Prerequisites
- Java 17+
- Maven 3.8+
- PostgreSQL running locally
- Database: `ShoppingMall`
- Credentials configured in `src/main/resources/application.properties`
  - `spring.datasource.url=jdbc:postgresql://localhost:5432/ShoppingMall`
  - `spring.datasource.username=postgres`
  - `spring.datasource.password=root`
  - `spring.jpa.hibernate.ddl-auto=update`

## Run
```bash
mvn spring-boot:run
```
Server runs on http://localhost:8080

## Base URLs
- Mall: `http://localhost:8080/malls`
- Shop: `http://localhost:8080/shops`
- Item: `http://localhost:8080/items`
- Customer: `http://localhost:8080/customers`
- Order: `http://localhost:8080/orders`
- Employee: `http://localhost:8080/employees`
- Shop Owner: `http://localhost:8080/shop-owners`

## Endpoints Overview
- Mall
  - POST `/malls` — create mall (with optional admin)
  - GET `/malls/{id}` — fetch mall by id
  - DELETE `/malls/{id}` — delete mall by id
- Shop
  - POST `/shops` — create shop (with optional owner and employees, link to an existing mall by id)
  - GET `/shops/{id}` — fetch shop by id
- Item
  - POST `/items` — create item under a mall
  - GET `/items/{id}` — fetch item by id
  - DELETE `/items/{id}` — delete item by id
- Customer
  - POST `/customers` — create customer
  - GET `/customers/{id}` — fetch customer by id
- Order
  - POST `/orders` — create an order linked to a customer and a shop
  - GET `/orders/{id}` — fetch order by id
- Employee
  - POST `/employees` — create employee
  - GET `/employees/{id}` — fetch employee by id

- Shop Owner
  - POST `/shop-owners` — create shop owner (link to an existing shop by `shop.shopId`)
  - GET `/shop-owners/{id}` — fetch shop owner by id
  - DELETE `/shop-owners/{id}` — delete shop owner by id

Note: DELETE for Shop/Customer/Order/Employee can be added similarly if you need them. Ask and we will enable them.

## JSON Payloads
Use these JSON bodies in Insomnia/Postman. Dates use ISO-8601 strings.

### 1) Create Mall
POST `http://localhost:8080/malls`
```json
{
  "mallName": "City Center",
  "location": "Downtown",
  "categories": "Fashion,Electronics,Food",
  "mallAdmin": {
    "name": "Alice",
    "password": "admin123",
    "phone": "9998887777"
  }
}
```
Response: 200 OK with created Mall JSON.

GET a Mall
GET `http://localhost:8080/malls/1`

DELETE a Mall
DELETE `http://localhost:8080/malls/1`

### 2) Create Shop (with Owner and Employees)
Link the Shop to an existing Mall by id in the `mall` field.

POST `http://localhost:8080/shops`
```json
{
  "shopCategory": "Electronics",
  "shopName": "Tech World",
  "customers": "Walk-in",
  "shopStatus": "OPEN",
  "leaseStatus": "ACTIVE",
  "mall": { "id": 1 },
  "shopEmployeeID": [
    {
      "id": 101,
      "name": "John Worker",
      "dob": "1995-01-15",
      "salary": 35000,
      "address": "Block A, City",
      "designation": "Sales"
    },
    {
      "id": 102,
      "name": "Jane Clerk",
      "dob": "1998-05-02",
      "salary": 30000,
      "address": "Block B, City",
      "designation": "Cashier"
    }
  ],
  "shopOwner": {
    "id": 501,
    "name": "Mr. Owner",
    "address": "Green Street",
    "dob": "1980-02-20"
  }
}
```
GET a Shop
GET `http://localhost:8080/shops/1`

### 3) Create Item under a Mall
POST `http://localhost:8080/items`
```json
{
  "name": "Laptop",
  "manufacturing": "2024-01-02",
  "expiry": "2027-01-01",
  "price": 89999.99,
  "category": "Electronics",
  "mall": { "id": 1 }
}
```
GET an Item
GET `http://localhost:8080/items/1`

DELETE an Item
DELETE `http://localhost:8080/items/1`

### 4) Create Customer
POST `http://localhost:8080/customers`
```json
{
  "name": "Rahul",
  "phone": "9876543210",
  "email": "rahul@example.com"
}
```
GET a Customer
GET `http://localhost:8080/customers/1`

### 5) Create OrderDetails (link Customer and Shop)
- Ensure you created a Customer and a Shop first and use their IDs.

POST `http://localhost:8080/orders`
```json
{
  "dateOfPurchase": "2025-09-21T12:00:00",
  "total": 1299.50,
  "paymentMode": "CARD",
  "customer": { "id": 1 },
  "shop": { "shopId": 1 }
}
```
GET an Order
GET `http://localhost:8080/orders/1`

### 6) Create Employee directly
POST `http://localhost:8080/employees`
```json
{
  "id": 103,
  "name": "Sam Helper",
  "dob": "1990-07-20",
  "salary": 28000,
  "address": "Blue Lane",
  "designation": "Helper",
  "shop": { "shopId": 1 }
}
```
GET an Employee
GET `http://localhost:8080/employees/103`

### 7) Create Shop Owner directly
POST `http://localhost:8080/shop-owners`
```json
{
  "id": 601,
  "name": "Priya Owner",
  "address": "Sunset Road",
  "dob": "1985-06-10",
  "shop": { "shopId": 1 }
}
```
GET a Shop Owner
GET `http://localhost:8080/shop-owners/601`

DELETE a Shop Owner
DELETE `http://localhost:8080/shop-owners/601`

## Insomnia Tips
- Set header: `Content-Type: application/json`
- Use the exact URLs above
- Send POST requests with the payloads; then verify with corresponding GETs

## Notes
- Circular JSON issues are avoided via `@JsonIgnore` on some back-references
  - `Mall.shops`, `Employee.shop`, `ShopOwner.shop`
- IDs
  - `Mall`, `Shop`, `Item`, `OrderDetails`, `Customer` use auto-generated IDs (where configured)
  - `Employee` and `ShopOwner` IDs are provided in the request as per the class design
- Relationships
  - A `Shop` belongs to one `Mall`
  - A `Shop` has one `ShopOwner` and many `Employees`
  - An `OrderDetails` belongs to a `Customer` and a `Shop`

## Troubleshooting
- If you change entities, run `Project > Clean` in Eclipse or `mvn clean` and re-run.
- Ensure the database exists and credentials are correct.
- If the app fails to start, check the console for stack traces and share them for help.
- Query the correct lowercase table names in PostgreSQL. Examples:
  - `select * from mall;`
  - `select * from mall_admin;`
  - `select * from shop;`
  - `select * from customer;`
  - `select * from order_details;`
  - `select * from item;`

### Why is the returned `id` already 5 (or jumping)?
Auto-increment IDs are generated by PostgreSQL sequences. They only increase and do not reuse values by default. If you created and deleted rows multiple times, the next insert may show a larger `id` (e.g., 5).

To reset IDs during development, you can truncate tables and restart identities. Use with caution (this deletes data):

```sql
TRUNCATE TABLE mall_admin RESTART IDENTITY CASCADE;
TRUNCATE TABLE mall RESTART IDENTITY CASCADE;
TRUNCATE TABLE shop RESTART IDENTITY CASCADE;
TRUNCATE TABLE employee RESTART IDENTITY CASCADE;
TRUNCATE TABLE customer RESTART IDENTITY CASCADE;
TRUNCATE TABLE order_details RESTART IDENTITY CASCADE;
TRUNCATE TABLE item RESTART IDENTITY CASCADE;
```

Alternatively, you can temporarily use this for a fresh schema each run (dev only):

```
spring.jpa.hibernate.ddl-auto=create-drop
```
Revert back to `update` when you want to preserve data.
